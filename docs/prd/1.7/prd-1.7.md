# 活躍度面板系統 PRD v1.7

## 📋 專案概述

### 背景
活躍度面板系統是Discord ADR機器人的核心功能之一，用於管理和監控伺服器成員的活躍度。目前系統存在面板實現不完整、權限設計不當等問題，需要重新設計和實現。

### 目標
建立一個完整、易用且權限合理的活躍度面板系統，提供直觀的管理介面和豐富的統計功能。

## 🎯 核心需求

### 1. 面板實現問題
**現況**: 活躍度面板並未完全實現，打開面板顯示頁面main不存在
**需求**: 
- 實現完整的活躍度面板系統
- 確保所有頁面功能正常運作
- 提供穩定的用戶體驗

### 2. 設計通用性問題
**現況**: 活躍度面板的設計過於通用
**需求**: 
- 參照活躍度模塊的實際需要進行設計
- 針對活躍度系統特性優化界面
- 提供專屬的活躍度管理功能

### 3. 權限設計問題
**現況**: 面板權限設計不合理
**需求**: 
- 面板應該是所有人可見，但有權限檢查
- 區分查看權限和操作權限
- 實現分層權限管理

## 🔧 功能規格

### 核心功能模塊

#### 1. 設定頁面 (Settings Page)
**功能描述**: 管理活躍度系統的核心設定
**主要功能**:
- 播報頻道設定
- 活躍度計算參數調整
- 自動播報時間設定
- 系統開關控制

**權限要求**:
- 查看: 所有成員
- 修改: 管理伺服器權限

#### 2. 預覽頁面 (Preview Page)
**功能描述**: 預覽活躍度排行榜效果
**主要功能**:
- 即時排行榜預覽
- 不同時間範圍切換
- 視覺化效果展示

**權限要求**:
- 查看: 所有成員
- 操作: 所有成員

#### 3. 統計頁面 (Stats Page)
**功能描述**: 查看活躍度系統統計資訊
**主要功能**:
- 系統使用統計
- 用戶活躍度分析
- 頻道活躍度排行
- 歷史數據趨勢

**權限要求**:
- 查看: 所有成員
- 詳細數據: 管理伺服器權限

#### 4. 歷史記錄頁面 (History Page)
**功能描述**: 查看活躍度歷史記錄
**主要功能**:
- 歷史排行榜記錄
- 用戶活躍度變化
- 數據導出功能

**權限要求**:
- 查看: 所有成員
- 導出: 管理伺服器權限

### 權限設計

#### 權限分層架構
```
1. 查看權限 (View Permission)
   - 適用對象: 所有伺服器成員
   - 功能範圍: 查看面板、預覽排行榜、查看統計

2. 基本操作權限 (Basic Operation Permission)
   - 適用對象: 所有伺服器成員
   - 功能範圍: 查看個人活躍度、切換頁面

3. 管理權限 (Management Permission)
   - 適用對象: 擁有「管理伺服器」權限的成員
   - 功能範圍: 修改系統設定、清除數據、設定頻道

4. 高級管理權限 (Advanced Management Permission)
   - 適用對象: 伺服器管理員
   - 功能範圍: 數據導出、系統重置、詳細統計
```

#### 權限檢查邏輯
```python
def check_permission(user, action_type):
    if action_type == "view":
        return True  # 所有人可查看
    
    elif action_type == "basic_operation":
        return True  # 所有人可基本操作
    
    elif action_type == "management":
        return user.guild_permissions.manage_guild
    
    elif action_type == "advanced_management":
        return user.guild_permissions.administrator
```

## 🎨 界面設計

### 面板佈局
```
┌─────────────────────────────────────┐
│ 📊 活躍度系統管理面板              │
├─────────────────────────────────────┤
│ [設定] [預覽] [統計] [歷史]        │
├─────────────────────────────────────┤
│ [重新整理] [設定頻道] [清除數據]   │
├─────────────────────────────────────┤
│ [關閉]                             │
└─────────────────────────────────────┘
```

### 頁面切換設計
- 使用按鈕式頁面切換
- 保持當前頁面狀態
- 提供頁面載入指示器

### 響應式設計
- 適配不同螢幕尺寸
- 支援手機端查看
- 優化按鈕排列

## 🔧 技術實現

### 架構設計
```
ActivityPanelView (主面板)
├── SettingsPage (設定頁面)
├── PreviewPage (預覽頁面)
├── StatsPage (統計頁面)
└── HistoryPage (歷史頁面)
```

### 核心組件
1. **ActivityPanelView**: 主面板控制器
2. **PageManager**: 頁面管理器
3. **PermissionChecker**: 權限檢查器
4. **DataRenderer**: 數據渲染器

### 數據流程
```
用戶操作 → 權限檢查 → 頁面切換 → 數據獲取 → 界面更新
```

## 📊 測試計劃

### 功能測試
- [ ] 面板載入測試
- [ ] 頁面切換測試
- [ ] 權限檢查測試
- [ ] 數據顯示測試

### 權限測試
- [ ] 普通成員權限測試
- [ ] 管理員權限測試
- [ ] 權限邊界測試

### 性能測試
- [ ] 面板響應速度測試
- [ ] 數據載入性能測試
- [ ] 並發訪問測試

## 🚀 實施計劃

### Phase 1: 基礎架構 (1-2天)
- [ ] 實現基礎面板架構
- [ ] 建立權限檢查系統
- [ ] 實現頁面切換功能

### Phase 2: 核心功能 (2-3天)
- [ ] 實現設定頁面
- [ ] 實現預覽頁面
- [ ] 實現統計頁面
- [ ] 實現歷史頁面

### Phase 3: 優化完善 (1-2天)
- [ ] 界面優化
- [ ] 性能優化
- [ ] 錯誤處理完善
- [ ] 文檔更新

### Phase 4: 測試部署 (1天)
- [ ] 功能測試
- [ ] 權限測試
- [ ] 性能測試
- [ ] 部署上線

## 📝 驗收標準

### 功能驗收
- [ ] 所有頁面正常載入
- [ ] 頁面切換流暢
- [ ] 權限檢查準確
- [ ] 數據顯示正確

### 性能驗收
- [ ] 面板載入時間 < 2秒
- [ ] 頁面切換時間 < 1秒
- [ ] 支持100+並發用戶

### 用戶體驗驗收
- [ ] 界面直觀易用
- [ ] 錯誤提示清晰
- [ ] 操作流程順暢

## 🔄 後續優化

### 短期優化 (1-2週)
- 增加更多統計圖表
- 優化移動端體驗
- 增加快捷操作功能

### 中期優化 (1個月)
- 增加自定義主題
- 實現數據導出功能
- 增加批量操作功能

### 長期優化 (3個月)
- 實現實時數據更新
- 增加AI輔助分析
- 實現跨伺服器統計

---

**文檔版本**: v1.7  
**創建日期**: 2025-01-18  
**最後更新**: 2025-01-18  
**負責人**: 開發團隊