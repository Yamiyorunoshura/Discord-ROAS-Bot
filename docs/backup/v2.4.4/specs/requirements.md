# 需求文件

## 簡介

本文件概述了 ROAS Discord Bot v2.4.4 的需求。本版本主要專注於修復現有的啟動腳本問題、添加子機器人功能以及集成 AI LLM API 能力，同時提供全自動的部署和啟動體驗。

## 需求

### 需求 1：自動化部署和啟動系統

**使用者故事：** 作為新用戶和系統管理員，我希望有一個完全自動化且可靠的部署系統，能夠智能檢測並安裝必要的依賴，自動構建並啟動機器人，在不同部署方式間提供降級機制，以便在任何環境下都能順利部署和可靠啟動機器人。

#### 驗收標準

1. When 執行自動安裝腳本時，Then 腳本應該先檢測當前系統是否已安裝 Docker
2. When 檢測到 Docker 未安裝時，Then 腳本應該根據作業系統（Linux、macOS、Windows）嘗試自動安裝 Docker
3. When Docker 安裝失敗或不可用時，Then 腳本應該自動轉為檢測和安裝 Python/uv 環境
4. When Docker 就緒後，Then 腳本應該自動執行容器構建和啟動流程
5. When 改用 Python/uv 模式時，Then 腳本應該自動安裝依賴並直接啟動機器人
6. When 執行 `bash scripts/start.sh` 時，Then 腳本應該首先嘗試使用 Docker Compose 啟動機器人
7. When Docker 容器構建或啟動失敗時，Then 腳本應該自動檢測失敗原因並提示降級到 uv 啟動模式
8. When 降級到 uv 啟動時，Then 腳本應該自動安裝所需依賴並使用 uv 直接啟動 Python 應用程式
9. When uv 啟動也失敗時，Then 腳本應該返回詳細的錯誤訊息並終止執行
10. When Docker 模式成功啟動時，Then 所有依賴的服務（Redis、資料庫等）應該能正常啟動
11. When uv 模式啟動時，Then 腳本應該能夠處理本地 Redis 連接或使用內嵌資料庫
12. When 使用不同的 profile 參數時，Then 腳本應該能正確載入對應的環境配置（支援兩種啟動模式）
13. When 遇到權限問題時，Then 腳本應該提供清晰的指示來解決權限問題
14. When 在不同作業系統上執行時，Then 腳本應該能夠適應不同的包管理器和安裝方式
15. When 安裝過程完成時，Then 腳本應該提供後續配置和使用的指引訊息，包括降級模式的說明
16. When 檢查系統需求時，Then 腳本應該同時檢查 Docker 和 Python/uv 的可用性

### 需求 2：子機器人聊天功能和管理系統

**使用者故事：** 作為機器人管理員和系統管理員，我希望能夠創建和管理專門的子機器人實例來在指定頻道中與使用者進行聊天互動，並有簡單的管理介面來監控這些子機器人，以便提供專門的對話服務和有效的管理。

#### 驗收標準

1. When 使用指令創建子機器人時，Then 系統應該生成一個獨立的機器人實例配置，專門用於聊天功能
2. When 子機器人啟動時，Then 它應該有自己的 Discord Token 並能夠在指定的頻道中運行
3. When 使用者在頻道中與子機器人互動時，Then 子機器人應該能夠識別並回應訊息
4. When 子機器人發生錯誤時，Then 不應該影響主機器人和其他子機器人的運行
5. When 配置子機器人時，Then 應該能夠指定子機器人負責的特定頻道或頻道類型
6. When 子機器人處理聊天訊息時，Then 應該支援基本的對話功能和訊息回應
7. When 管理子機器人時，Then 應該能夠查看每個子機器人的基本運行狀態和負責頻道
8. When 訪問管理介面時，Then 應該顯示所有聊天子機器人的基本狀態（在線/離線、所屬頻道）
9. When 檢視子機器人詳情時，Then 應該顯示每個子機器人的連接狀態、負責頻道和基本錯誤日誌
10. When 創建新的聊天子機器人時，Then 應該提供簡單的引導式設定流程（Token、頻道指定）
11. When 修改子機器人配置時，Then 應該能夠更新頻道分配和基本設定
12. When 監控聊天活動時，Then 應該提供基本的訊息統計（訊息數量、活躍時間）
13. When 管理 AI 聊天功能時，Then 應該顯示各子機器人的 AI 對話次數和基本統計
14. When 需要進行維護時，Then 應該能夠重啟或停止特定的聊天子機器人實例

### 需求 3：AI LLM 集成和安全控制系統

**使用者故事：** 作為 Discord 使用者和機器人擁有者，我希望機器人能夠集成先進的 AI 語言模型來提供智能對話功能，同時具備完善的安全控制和成本管理機制，以便獲得安全、可控且經濟有效的智能互動體驗。

#### 驗收標準

1. When 配置 AI API 金鑰時，Then 系統應該支援多種 LLM 提供商（OpenAI、Anthropic、Google 等）
2. When 使用者發送 AI 對話指令時，Then 機器人應該能夠將訊息傳送給對應的 LLM API 並回傳結果
3. When AI API 回應時，Then 內容應該經過適當的格式化以符合 Discord 訊息限制
4. When AI API 發生錯誤時，Then 系統應該有適當的錯誤處理和使用者友善的錯誤訊息
5. When 使用 AI 功能時，Then 應該實施使用頻率限制以控制 API 成本
6. When 聊天子機器人啟用 AI 功能時，Then 每個子機器人應該能夠在其負責的頻道中提供 AI 對話服務
7. When 管理 AI 對話記錄時，Then 系統應該能夠儲存基本的對話歷史以支援聊天上下文
8. When 配置子機器人 AI 行為時，Then 應該能夠為不同的聊天子機器人設定不同的對話風格和回應模式
9. When 使用者請求 AI 服務時，Then 系統應該驗證使用者的權限和剩餘配額
10. When AI API 使用量超過設定限制時，Then 系統應該暫停服務並通知管理員
11. When 檢測到異常的 API 使用模式時，Then 系統應該自動觸發安全警報
12. When 設定使用者配額時，Then 應該支援按時間（每日/每週）和按次數的限制方式
13. When 儲存 AI 對話內容時，Then 應該實施適當的資料加密和隱私保護
14. When 配置敏感詞過濾時，Then AI 回應應該經過內容審查以確保符合社區規範
15. When 生成成本報告時，Then 應該提供詳細的 API 使用統計和費用分析
