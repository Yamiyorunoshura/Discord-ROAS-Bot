# Discord ADR Bot v1.6.3 ç”¢å“éœ€æ±‚æ–‡ä»¶ (PRD)

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

æœ¬ç‰ˆæœ¬ä¸»è¦ä¿®å¾©å„æ¨¡çµ„é¢æ¿è¼‰å…¥å•é¡Œï¼Œæ¢å¾©æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸¦å¢å¼·ç³»çµ±æ¬Šé™é©—è­‰æ©Ÿåˆ¶ã€‚æ‰€æœ‰ä¿®å¾©éƒ½æ‡‰éµå¾ªé …ç›®çš„çµ±ä¸€éŒ¯èª¤è™•ç†å’Œæ¨¡çµ„åŒ–æ¶æ§‹åŸå‰‡ã€‚

## ğŸ¯ æ ¸å¿ƒä¿®å¾©éœ€æ±‚

### 1. Welcome Cog æ­¡è¿æ¨¡çµ„ä¿®å¾©
**å•é¡Œæè¿°**: é¢æ¿è¼‰å…¥å¤±æ•—
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/welcome/`

**æŠ€è¡“è¦æ ¼**:
- æª¢æŸ¥ `panel/main_view.py` ä¸­çš„è¦–åœ–åˆå§‹åŒ–
- ä¿®å¾© `components/modals.py` ä¸­çš„æ¨¡æ…‹æ¡†è¼‰å…¥å•é¡Œ
- ç¢ºä¿ `database/database.py` é€£æ¥æ± æ­£å¸¸é‹ä½œ
- é©—è­‰ `config/config.py` é…ç½®è¼‰å…¥

**é æœŸè¡Œç‚º**:
- é¢æ¿èƒ½æ­£å¸¸è¼‰å…¥ä¸¦é¡¯ç¤ºæ­¡è¿è¨­å®šä»‹é¢
- æ‰€æœ‰æŒ‰éˆ•å’Œé¸é …æ­£å¸¸éŸ¿æ‡‰
- æ­¡è¿åœ–ç‰‡ç”ŸæˆåŠŸèƒ½æ­£å¸¸é‹ä½œ

**éŒ¯èª¤ç¢¼ç¯„åœ**: 501-510
**æ¸¬è©¦æ¨™æº–**: 
- [ ] é¢æ¿è¼‰å…¥ç„¡ç•°å¸¸
- [ ] è¨­å®šä¿å­˜æˆåŠŸ
- [ ] æ­¡è¿åœ–ç‰‡æ­£å¸¸ç”Ÿæˆ

### 2. Anti-Executable Cog åå¯åŸ·è¡Œæª”æ¡ˆæ¨¡çµ„ä¿®å¾©
**å•é¡Œæè¿°**: é¢æ¿è¼‰å…¥ç™¼ç”ŸéŒ¯èª¤
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/protection/anti_executable/`

**æŠ€è¡“è¦æ ¼**:
- æª¢æŸ¥ `panel/main_view.py` çš„è¦–åœ–é¡ç¹¼æ‰¿å•é¡Œ
- ä¿®å¾© `components/buttons.py` ä¸­çš„æŒ‰éˆ•å›èª¿å‡½æ•¸
- é©—è­‰ `database/database.py` çš„è³‡æ–™è¡¨çµæ§‹
- ç¢ºä¿ `embeds/` ç›®éŒ„ä¸‹çš„åµŒå…¥è¨Šæ¯æ ¼å¼æ­£ç¢º

**é æœŸè¡Œç‚º**:
- é˜²è­·è¨­å®šé¢æ¿æ­£å¸¸è¼‰å…¥
- é»‘åå–®/ç™½åå–®ç·¨è¼¯åŠŸèƒ½æ­£å¸¸
- æª”æ¡ˆæ ¼å¼æª¢æ¸¬åŠŸèƒ½æ­£å¸¸é‹ä½œ
- çµ±è¨ˆè³‡æ–™æ­£ç¢ºé¡¯ç¤º

**éŒ¯èª¤ç¢¼ç¯„åœ**: 511-520
**æ¸¬è©¦æ¨™æº–**:
- [ ] é¢æ¿è¼‰å…¥ç„¡ç•°å¸¸
- [ ] é˜²è­·è¦å‰‡æ­£å¸¸é‹ä½œ
- [ ] çµ±è¨ˆè³‡æ–™æº–ç¢ºé¡¯ç¤º

### 3. æ€§èƒ½ç›£æ§æ¨¡çµ„å¢å¼·
**å•é¡Œæè¿°**: æ”¹ç‚ºéåƒ…å€‹äººå¯è¦‹ï¼ŒåŠ å…¥æ¬Šé™èªè­‰
**å„ªå…ˆç´š**: ä¸­
**æ¨¡çµ„è·¯å¾‘**: `cogs/core/performance_dashboard.py`

**æŠ€è¡“è¦æ ¼**:
- ç§»é™¤ `ephemeral=True` è¨­å®š
- å¯¦ä½œæ¬Šé™é©—è­‰è£é£¾å™¨ `@require_permission("manage_guild")`
- åŠ å…¥ç”¨æˆ¶æ¬Šé™æª¢æŸ¥é‚è¼¯
- å¢å¼·è³‡æ–™å±•ç¤ºçš„å®‰å…¨æ€§

**é æœŸè¡Œç‚º**:
- åªæœ‰å…·å‚™ç®¡ç†æ¬Šé™çš„ç”¨æˆ¶å¯ä»¥æŸ¥çœ‹
- æ€§èƒ½æ•¸æ“šå…¬é–‹é¡¯ç¤ºï¼ˆéç§äººè¨Šæ¯ï¼‰
- ä¿è­·æ•æ„Ÿç³»çµ±è³‡è¨Š

**éŒ¯èª¤ç¢¼ç¯„åœ**: 521-530
**æ¸¬è©¦æ¨™æº–**:
- [ ] æ¬Šé™æª¢æŸ¥æ­£å¸¸é‹ä½œ
- [ ] éç®¡ç†å“¡ç„¡æ³•è¨ªå•
- [ ] è³‡æ–™é¡¯ç¤ºæ­£ç¢º

### 4. Anti-Spam ååƒåœ¾è¨Šæ¯æ¨¡çµ„æ¢å¾©
**å•é¡Œæè¿°**: é¢æ¿é–‹å•Ÿå¾Œé¡¯ç¤ºåŠŸèƒ½æ­£åœ¨é‡æ§‹ï¼Œæ¢å¾©å…¶æ‡‰æœ‰åŠŸèƒ½
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/protection/anti_spam/`

**æŠ€è¡“è¦æ ¼**:
- ç§»é™¤ã€ŒåŠŸèƒ½æ­£åœ¨é‡æ§‹ã€çš„æš«æ™‚æ€§è¨Šæ¯
- æ¢å¾©åƒåœ¾è¨Šæ¯æª¢æ¸¬æ¼”ç®—æ³•
- ä¿®å¾© `main/main.py` ä¸­çš„æ ¸å¿ƒé‚è¼¯
- ç¢ºä¿ `panel/embeds/settings_embed.py` æ­£å¸¸é¡¯ç¤º

**é æœŸè¡Œç‚º**:
- åƒåœ¾è¨Šæ¯è‡ªå‹•æª¢æ¸¬å’Œè™•ç†
- è¨­å®šé¢æ¿å®Œå…¨å¯ç”¨
- ç™½åå–®åŠŸèƒ½æ­£å¸¸é‹ä½œ
- çµ±è¨ˆè³‡æ–™æ­£ç¢ºè¿½è¹¤

**éŒ¯èª¤ç¢¼ç¯„åœ**: 531-540
**æ¸¬è©¦æ¨™æº–**:
- [ ] åƒåœ¾è¨Šæ¯æª¢æ¸¬æ­£å¸¸
- [ ] è¨­å®šé¢æ¿åŠŸèƒ½å®Œæ•´
- [ ] çµ±è¨ˆè³‡æ–™æº–ç¢º

### 5. Sync Data è³‡æ–™åŒæ­¥æ¨¡çµ„ä¿®å¾©
**å•é¡Œæè¿°**: è¼‰å…¥ç‹€æ…‹ç™¼ç”ŸéŒ¯èª¤ï¼Œä¿®å¾©å•é¡Œï¼ŒæŠŠå·²ç¶“åŠ å…¥é¢æ¿çš„æ–œç·šæŒ‡ä»¤å–æ¶ˆè¨»å†Š
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/sync_data/`

**æŠ€è¡“è¦æ ¼**:
- ä¿®å¾© `main/main.py` ä¸­çš„è¼‰å…¥ç‹€æ…‹é‚è¼¯
- ç§»é™¤é‡è¤‡çš„æ–œç·šæŒ‡ä»¤è¨»å†Š
- ä¿®å¾© `panel/embeds/status_embed.py` çš„ç‹€æ…‹é¡¯ç¤º
- ç¢ºä¿ `database/database.py` åŒæ­¥ç‹€æ…‹æ­£ç¢ºè¿½è¹¤

**é æœŸè¡Œç‚º**:
- åŒæ­¥ç‹€æ…‹æ­£ç¢ºé¡¯ç¤º
- ç„¡é‡è¤‡çš„æ–œç·šæŒ‡ä»¤
- åŒæ­¥æ“ä½œæ­£å¸¸åŸ·è¡Œ
- æ­·å²è¨˜éŒ„æ­£ç¢ºè¨˜éŒ„

**éŒ¯èª¤ç¢¼ç¯„åœ**: 541-550
**æ¸¬è©¦æ¨™æº–**:
- [ ] è¼‰å…¥ç‹€æ…‹é¡¯ç¤ºæ­£ç¢º
- [ ] æ–œç·šæŒ‡ä»¤ç„¡é‡è¤‡
- [ ] åŒæ­¥åŠŸèƒ½æ­£å¸¸é‹ä½œ

### 6. Activity Meter æ´»èºåº¦æ¨¡çµ„ä¿®å¾©
**å•é¡Œæè¿°**: æ´»èºåº¦æ¢ç„¡æ³•æ­£å¸¸é¡¯ç¤ºä¸­æ–‡å­—é«”ï¼Œé¢æ¿è¼‰å…¥å¤±æ•—
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/activity_meter/`

**æŠ€è¡“è¦æ ¼**:
- ä¿®å¾© `main/renderer.py` ä¸­çš„ä¸­æ–‡å­—é«”è¼‰å…¥å•é¡Œ
- æª¢æŸ¥å­—é«”æ–‡ä»¶è·¯å¾‘: `fonts/NotoSansCJKtc-Regular.otf`, `fonts/wqy-microhei.ttc`
- ä¿®å¾© `panel/main_view.py` çš„è¼‰å…¥å•é¡Œ
- ç¢ºä¿ `main/calculator.py` åˆ†æ•¸è¨ˆç®—æ­£ç¢º

**é æœŸè¡Œç‚º**:
- æ´»èºåº¦æ¢æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡ç”¨æˆ¶å
- é¢æ¿è¼‰å…¥å’Œæ“ä½œæ­£å¸¸
- åˆ†æ•¸è¨ˆç®—å’Œæ’è¡Œæ¦œåŠŸèƒ½æ­£å¸¸
- åœ–ç‰‡ç”ŸæˆåŒ…å«æ­£ç¢ºçš„ä¸­æ–‡å­—é«”

**éŒ¯èª¤ç¢¼ç¯„åœ**: 551-560
**æ¸¬è©¦æ¨™æº–**:
- [ ] ä¸­æ–‡å­—é«”é¡¯ç¤ºæ­£å¸¸
- [ ] é¢æ¿è¼‰å…¥ç„¡ç•°å¸¸
- [ ] æ’è¡Œæ¦œåŠŸèƒ½æ­£å¸¸

### 7. Anti-Link åé€£çµæ¨¡çµ„æ¢å¾©
**å•é¡Œæè¿°**: é¢æ¿é¡¯ç¤ºå·²åœç”¨ï¼Œæ¢å¾©å…¶æ‡‰æœ‰åŠŸèƒ½
**å„ªå…ˆç´š**: é«˜
**æ¨¡çµ„è·¯å¾‘**: `cogs/protection/anti_link/`

**æŠ€è¡“è¦æ ¼**:
- ç§»é™¤ã€Œå·²åœç”¨ã€ç‹€æ…‹æ¨™è¨˜
- æ¢å¾©é€£çµæª¢æ¸¬é‚è¼¯åœ¨ `main/main.py`
- ä¿®å¾© `panel/embeds/config_embed.py` çš„é…ç½®é¡¯ç¤º
- ç¢ºä¿é»‘åå–®/ç™½åå–®åŠŸèƒ½æ­£å¸¸

**é æœŸè¡Œç‚º**:
- é€£çµæª¢æ¸¬å’Œæ””æˆªåŠŸèƒ½æ­£å¸¸
- è¨­å®šé¢æ¿å®Œå…¨å¯ç”¨
- é»‘åå–®/ç™½åå–®ç®¡ç†åŠŸèƒ½æ­£å¸¸
- çµ±è¨ˆè³‡æ–™æ­£ç¢ºé¡¯ç¤º

**éŒ¯èª¤ç¢¼ç¯„åœ**: 561-570
**æ¸¬è©¦æ¨™æº–**:
- [ ] é€£çµæª¢æ¸¬æ­£å¸¸é‹ä½œ
- [ ] è¨­å®šé¢æ¿åŠŸèƒ½å®Œæ•´
- [ ] çµ±è¨ˆè³‡æ–™æº–ç¢º

## ğŸ”§ æŠ€è¡“å¯¦ç¾æŒ‡å—

### çµ±ä¸€éŒ¯èª¤è™•ç†
æ‰€æœ‰ä¿®å¾©éƒ½å¿…é ˆä½¿ç”¨é …ç›®çš„çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼š

```python
from cogs.core.error_handler import create_error_handler

# åœ¨æ¯å€‹æ¨¡çµ„ä¸­
handler = create_error_handler(self.__class__.__name__)
with handler.handle_error(error_code=å…·é«”éŒ¯èª¤ç¢¼):
    # æ¥­å‹™é‚è¼¯
```

### é¢æ¿è¼‰å…¥æ¨™æº–æµç¨‹
1. æª¢æŸ¥ `main_view.py` ä¸­çš„è¦–åœ–åˆå§‹åŒ–
2. é©—è­‰ `components/` ç›®éŒ„ä¸‹çš„çµ„ä»¶è¼‰å…¥
3. ç¢ºä¿ `embeds/` ç›®éŒ„ä¸‹çš„åµŒå…¥è¨Šæ¯æ ¼å¼
4. æ¸¬è©¦è³‡æ–™åº«é€£æ¥å’ŒæŸ¥è©¢

### æ¬Šé™é©—è­‰å¯¦ç¾
```python
def is_allowed(interaction: discord.Interaction, action: str = "") -> bool:
    """æª¢æŸ¥ç”¨æˆ¶æ¬Šé™"""
    if not interaction.guild:
        return False
    member = interaction.guild.get_member(interaction.user.id)
    return member.guild_permissions.manage_guild if member else False
```

### æ—¥èªŒè¨˜éŒ„è¦æ±‚
æ‰€æœ‰ä¿®å¾©éƒ½å¿…é ˆåŒ…å«é©ç•¶çš„æ—¥èªŒè¨˜éŒ„ï¼š

```python
logger = setup_module_logger(self.__class__.__name__)
logger.info(f"æ¨¡çµ„è¼‰å…¥å®Œæˆ: {self.__class__.__name__}")
```

## ğŸ“Š æ¸¬è©¦æ¨™æº–

### è‡ªå‹•åŒ–æ¸¬è©¦
- [ ] æ‰€æœ‰æ¨¡çµ„çš„å–®å…ƒæ¸¬è©¦é€šé
- [ ] é¢æ¿è¼‰å…¥æ¸¬è©¦ç„¡ç•°å¸¸
- [ ] è³‡æ–™åº«æ“ä½œæ¸¬è©¦æ­£å¸¸
- [ ] éŒ¯èª¤è™•ç†æ¸¬è©¦è¦†è“‹

### æ‰‹å‹•æ¸¬è©¦
- [ ] æ‰€æœ‰é¢æ¿å¯ä»¥æ­£å¸¸è¼‰å…¥
- [ ] åŠŸèƒ½æŒ‰éˆ•éŸ¿æ‡‰æ­£å¸¸
- [ ] è³‡æ–™é¡¯ç¤ºæ­£ç¢º
- [ ] éŒ¯èª¤è¨Šæ¯å‹å¥½

### æ€§èƒ½æ¸¬è©¦
- [ ] é¢æ¿è¼‰å…¥æ™‚é–“ < 2ç§’
- [ ] è³‡æ–™åº«æŸ¥è©¢æ™‚é–“ < 50ms
- [ ] è¨˜æ†¶é«”ä½¿ç”¨é‡ < 200MB
- [ ] ç„¡è¨˜æ†¶é«”æ´©æ¼

## ğŸš€ éƒ¨ç½²è¦æ±‚

### å‘å¾Œå…¼å®¹æ€§
- [ ] ç¾æœ‰è³‡æ–™åº«çµæ§‹ä¿æŒä¸è®Š
- [ ] ç¾æœ‰é…ç½®æ ¼å¼ä¿æŒå…¼å®¹
- [ ] ç”¨æˆ¶æ¬Šé™è¨­å®šä¿æŒä¸è®Š

### éƒ¨ç½²æª¢æŸ¥æ¸…å–®
- [ ] æ‰€æœ‰ä¾è³´é …ç›®å·²æ›´æ–°
- [ ] è³‡æ–™åº«é·ç§»è…³æœ¬å·²åŸ·è¡Œ
- [ ] é…ç½®æ–‡ä»¶å·²é©—è­‰
- [ ] æ—¥èªŒç›®éŒ„å·²å‰µå»º

## ğŸ“ å®Œæˆæ¨™æº–

### å®šç¾©å®Œæˆ (Definition of Done)
- [ ] æ‰€æœ‰éœ€æ±‚åŠŸèƒ½å·²å¯¦ç¾
- [ ] æ‰€æœ‰æ¸¬è©¦å·²é€šé
- [ ] ç¨‹å¼ç¢¼å·²é€šéå¯©æŸ¥
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] éƒ¨ç½²å·²é©—è­‰

### é©—æ”¶æ¢ä»¶
- [ ] æ‰€æœ‰é¢æ¿è¼‰å…¥æ­£å¸¸
- [ ] æ‰€æœ‰åŠŸèƒ½æŒ‰è¨­è¨ˆé‹ä½œ
- [ ] ç„¡é—œéµéŒ¯èª¤æˆ–è­¦å‘Š
- [ ] æ€§èƒ½ç¬¦åˆæŒ‡æ¨™è¦æ±‚
- [ ] ç”¨æˆ¶é«”é©—æµæš¢

## ğŸ” é™¤éŒ¯æŒ‡å—

### å¸¸è¦‹å•é¡Œæ’æŸ¥
1. **é¢æ¿è¼‰å…¥å¤±æ•—**: æª¢æŸ¥è¦–åœ–é¡ç¹¼æ‰¿å’Œåˆå§‹åŒ–
2. **æŒ‰éˆ•ç„¡éŸ¿æ‡‰**: é©—è­‰å›èª¿å‡½æ•¸å’Œæ¬Šé™
3. **è³‡æ–™åº«éŒ¯èª¤**: æª¢æŸ¥é€£æ¥æ± å’Œè¡¨çµæ§‹
4. **å­—é«”å•é¡Œ**: ç¢ºèªå­—é«”æ–‡ä»¶è·¯å¾‘å’Œæ ¼å¼

### æ—¥èªŒæª”æ¡ˆä½ç½®
- ä¸»è¦æ—¥èªŒ: `logs/main.log`
- éŒ¯èª¤æ—¥èªŒ: `logs/main_error.log`
- æ¨¡çµ„æ—¥èªŒ: `logs/[æ¨¡çµ„å].log`

### é™¤éŒ¯å‘½ä»¤
```bash
# æª¢æŸ¥æ—¥èªŒ
tail -f logs/main.log

# åŸ·è¡Œæ¸¬è©¦
python -m pytest tests/ -v

# æª¢æŸ¥ç¨‹å¼ç¢¼å“è³ª
python quality_check.py
```